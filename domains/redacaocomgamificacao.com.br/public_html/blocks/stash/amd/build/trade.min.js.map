{"version":3,"sources":["../src/trade.js"],"names":["define","$","Ajax","Log","Base","Counselor","Dialogue","Item","UserItem","Trade","tradedata","prototype","constructor","apply","Object","create","EVENT_TRADE","do","call","methodname","args","tradeid","get","hashcode","fail","debug","then","data","index","gaineditems","userItem","useritem","item","trigger","id","removeditems","bind"],"mappings":"AAuBAA,OAAM,qBAAC,CACH,QADG,CAEH,WAFG,CAGH,UAHG,CAIH,kBAJG,CAKH,uBALG,CAMH,4BANG,CAOH,kBAPG,CAQH,uBARG,CAAD,CASH,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAuBC,CAAvB,CAA6BC,CAA7B,CAAwCC,CAAxC,CAAkDC,CAAlD,CAAwDC,CAAxD,CAAkE,CAOjE,QAASC,CAAAA,CAAT,CAAeC,CAAf,CAA0B,CACtBN,CAAI,CAACO,SAAL,CAAeC,WAAf,CAA2BC,KAA3B,CAAiC,IAAjC,CAAuC,CAACH,CAAD,CAAvC,CACH,CACDD,CAAK,CAACE,SAAN,CAAkBG,MAAM,CAACC,MAAP,CAAcX,CAAI,CAACO,SAAnB,CAAlB,CAEAF,CAAK,CAACE,SAAN,CAAgBK,WAAhB,CAA8B,gBAA9B,CAGAP,CAAK,CAACE,SAAN,CAAgBM,EAAhB,CAAqB,UAAW,CAE5B,MAAOf,CAAAA,CAAI,CAACgB,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,4BADE,CAEdC,IAAI,CAAE,CACFC,OAAO,CAAE,KAAKC,GAAL,CAAS,IAAT,CADP,CAEFC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFR,CAFQ,CAAD,CAAV,EAMH,CANG,EAMAE,IANA,CAMK,UAAW,CACnBrB,CAAG,CAACsB,KAAJ,CAAU,mCAAV,CAEH,CATM,EASJC,IATI,CASC,SAASC,CAAT,CAAe,CAGnB,GAAIA,CAAJ,CAAU,CACN,IAAK,GAAIC,CAAAA,CAAT,GAAkBD,CAAAA,CAAI,CAACE,WAAvB,CAAoC,CAEhC,GAAIC,CAAAA,CAAQ,CAAG,GAAItB,CAAAA,CAAJ,CAAamB,CAAI,CAACE,WAAL,CAAiBD,CAAjB,EAAwBG,QAArC,CAA+C,GAAIxB,CAAAA,CAAJ,CAASoB,CAAI,CAACE,WAAL,CAAiBD,CAAjB,EAAwBI,IAAjC,CAA/C,CAAf,CACA3B,CAAS,CAAC4B,OAAV,CAAkB,KAAKjB,WAAvB,CAAoC,CAChCkB,EAAE,CAAE,KAAKZ,GAAL,CAAS,IAAT,CAD4B,CAEhCC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFsB,CAGhCS,QAAQ,CAAED,CAHsB,CAApC,CAKH,CAED,IAAK,GAAIF,CAAAA,CAAT,GAAkBD,CAAAA,CAAI,CAACQ,YAAvB,CAAqC,CACjC,GAAIL,CAAAA,CAAQ,CAAG,GAAItB,CAAAA,CAAJ,CAAamB,CAAI,CAACQ,YAAL,CAAkBP,CAAlB,EAAyBG,QAAtC,CAAgD,GAAIxB,CAAAA,CAAJ,CAASoB,CAAI,CAACQ,YAAL,CAAkBP,CAAlB,EAAyBI,IAAlC,CAAhD,CAAf,CACA3B,CAAS,CAAC4B,OAAV,CAAkB,KAAKjB,WAAvB,CAAoC,CAChCkB,EAAE,CAAE,KAAKZ,GAAL,CAAS,IAAT,CAD4B,CAEhCC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFsB,CAGhCS,QAAQ,CAAED,CAHsB,CAApC,CAKH,CACJ,CAEJ,CAxBO,CAwBNM,IAxBM,CAwBD,IAxBC,CATD,CAkCV,CApCD,CAuCA,MAA8C3B,CAAAA,CAEjD,CAjEK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Trade module.\n *\n * @package    block_stash\n * @copyright  2017 Adrian Greeve - adriangreeve.com\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/log',\n    'block_stash/base',\n    'block_stash/counselor',\n    'block_stash/trade-dialogue',\n    'block_stash/item',\n    'block_stash/user-item',\n], function($, Ajax, Log, Base, Counselor, Dialogue, Item, UserItem) {\n\n    /**\n     * Trade class.\n     *\n     * @param {Object} dropdata The data of this trade widget.\n     */\n    function Trade(tradedata) {\n        Base.prototype.constructor.apply(this, [tradedata]);\n    }\n    Trade.prototype = Object.create(Base.prototype);\n\n    Trade.prototype.EVENT_TRADE = 'trade:pickedup';\n\n\n    Trade.prototype.do = function() {\n\n        return Ajax.call([{\n            methodname: 'block_stash_complete_trade',\n            args: {\n                tradeid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].fail(function() {\n            Log.debug('The trade could not be completed.');\n\n        }).then(function(data) {\n\n            // Notify other areas about item removal and acquirement.\n            if (data) {\n                for (var index in data.gaineditems) {\n\n                    var userItem = new UserItem(data.gaineditems[index].useritem, new Item(data.gaineditems[index].item));\n                    Counselor.trigger(this.EVENT_TRADE, {\n                        id: this.get('id'),\n                        hashcode: this.get('hashcode'),\n                        useritem: userItem\n                    });\n                }\n\n                for (var index in data.removeditems) {\n                    var userItem = new UserItem(data.removeditems[index].useritem, new Item(data.removeditems[index].item));\n                    Counselor.trigger(this.EVENT_TRADE, {\n                        id: this.get('id'),\n                        hashcode: this.get('hashcode'),\n                        useritem: userItem\n                    });\n                }\n            }\n\n        }.bind(this));\n    };\n\n\n    return /** @alias module:block_stash/trade */ Trade;\n\n});\n"],"file":"trade.min.js"}