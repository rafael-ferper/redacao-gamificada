{"version":3,"sources":["../src/drop-snippet-maker.js"],"names":["define","$","Maker","drop","_drop","prototype","IMAGE","IMAGEANDBUTTON","TEXT","_actionText","_displayType","_label","_getActionText","trim","getDefaultActionText","_getAnchor","getDefaultLabel","getItem","get","_getDisplayButton","wrap","btn","text","append","_getDisplayImage","img","label","addClass","css","attr","getDrop","getDisplay","_getDisplayType","displaytype","display","anchor","_getLabel","getSnippet","node","uuid","wrapper","script","id","hashcode","snippet","_wrapForOnReady","html","setDisplayType","v","setActionText","setLabel","Math","random","toString","substring","Date","getTime","code"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop snippet maker module.\n *\n * @package    block_stash\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n], function($) {\n\n    /**\n     * Drop snippet maker class.\n     *\n     * @param {Drop} drop The drop.\n     */\n    function Maker(drop) {\n        this._drop = drop;\n    }\n\n    Maker.prototype.IMAGE = 'image';\n    Maker.prototype.IMAGEANDBUTTON = 'imageandbutton';\n    Maker.prototype.TEXT = 'text';\n\n    Maker.prototype._actionText = null;\n    Maker.prototype._displayType = Maker.prototype.IMAGEANDBUTTON;\n    Maker.prototype._label = null;\n\n    /**\n     * Get the action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getActionText = function() {\n        if (this._actionText === null || this._actionText.trim() === '') {\n            return this.getDefaultActionText();\n        }\n        return this._actionText;\n    };\n\n    /**\n     * Get the anchor.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getAnchor = function() {\n        return $('<a href=\"#\"></a>');\n    };\n\n    /**\n     * Get the default action text.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultActionText = function() {\n        return 'Pick up!';\n    };\n\n    /**\n     * Get the default label.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getDefaultLabel = function() {\n        return \"Pick up '\" + this.getItem().get('name') + \"'\";\n    };\n\n    /**\n     * Get the button.\n     *\n     * @return {Node}\n     */\n    Maker.prototype._getDisplayButton = function() {\n        var wrap = $('<div class=\"item-action\"></div>'),\n            btn = $('<button class=\"btn btn-secondary\"></button>');\n\n        btn.text(this._getActionText());\n        wrap.append(btn);\n\n        return wrap;\n    };\n\n    /**\n     * Get the image.\n     *\n     * @return {Node}\n     */\n\n    Maker.prototype._getDisplayImage = function() {\n        var img = $('<div class=\"item-image\"></div>'),\n            label = $('<div class=\"item-label\"></div>');\n\n        img.addClass('item-image');\n        img.css('backgroundImage', 'url(' + this.getItem().get('imageurl') + ')');\n        label.text(this.getItem().get('name'));\n        label.attr('title', this.getItem().get('name'));\n        img.append(label);\n\n        return img;\n    };\n\n    /**\n     * Get the drop.\n     *\n     * @return {Drop}\n     */\n    Maker.prototype.getDrop = function() {\n        return this._drop;\n    };\n\n    /**\n     * Get the whole display.\n     *\n     * @return {Node}\n     */\n    Maker.prototype.getDisplay = function() {\n        return this._getDisplayType(this._displayType);\n    };\n\n    /**\n     * Get the display by type.\n     *\n     * @param {String} displaytype The display type.\n     * @return {Drop}\n     */\n    Maker.prototype._getDisplayType = function(displaytype) {\n        var display,\n            anchor;\n\n        if (displaytype == this.IMAGE) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            anchor = this._getAnchor();\n            anchor.append(this._getDisplayImage());\n            display.append(anchor);\n\n        } else if (displaytype == this.IMAGEANDBUTTON) {\n            display = $('<div class=\"block-stash-item\"></div>');\n            display.append(this._getDisplayImage());\n            display.append(this._getDisplayButton());\n\n        } else {\n            display = $('<span></span>');\n            anchor = this._getAnchor();\n            anchor.text(this._getLabel());\n            display.append(anchor);\n        }\n\n        return display;\n    };\n\n    /**\n     * Get the drop item.\n     *\n     * @return {Item}\n     */\n    Maker.prototype.getItem = function() {\n        return this._drop.getItem();\n    };\n\n    /**\n     * Get the label.\n     *\n     * @return {String}\n     */\n    Maker.prototype._getLabel = function() {\n        if (this._label === null || this._label.trim() === '') {\n            return this.getDefaultLabel();\n        }\n        return this._label;\n    };\n\n    /**\n     * Get the snippet.\n     *\n     * @return {String}\n     */\n    Maker.prototype.getSnippet = function() {\n        var node = $('<div>'),\n            uuid = this.uuid(),\n            wrapper = $('<span id=\"' + uuid + '\">'),\n            script = $('<script type=\"text/javascript\">'),\n            id = this.getDrop().get('id'),\n            hashcode = this.getDrop().get('hashcode'),\n            display = this.getDisplay(),\n            snippet = '';\n\n        // No need to scope this in an anonymous function, it already is because of require.\n        // WARNING! Changing this structure could break restores!\n        snippet = '' +\n            'require([\"jquery\", \"block_stash/drop\"], function($, D) {' +\n            ' var d = new D({id: ' + id + ', hashcode: \"' + hashcode + '\"}), n = $(\"#' + uuid + '\");' +\n            ' if (!n.length) return; n.removeClass(); d.isVisible().then(function() { n.show(); });' +\n            ' n.find(\"a, button\").click(function(e) { e.preventDefault(); d.pickup(); n.remove(); });' +\n            '})';\n        snippet = this._wrapForOnReady(snippet);\n\n        node.append(wrapper);\n        wrapper.css('display', 'none');\n        wrapper.append(display);\n        wrapper.append(script);\n        script.html(snippet);\n\n        return node.html();\n    };\n\n    /**\n     * Set the display type.\n     *\n     * @param {String} v The display type.\n     */\n    Maker.prototype.setDisplayType = function(v) {\n        this._displayType = v;\n    };\n\n    /**\n     * Set the action text.\n     *\n     * @param {String} v The action text.\n     */\n    Maker.prototype.setActionText = function(v) {\n        this._actionText = v;\n    };\n\n    /**\n     * Set the label.\n     *\n     * @param {String} v The label.\n     */\n    Maker.prototype.setLabel = function(v) {\n        this._label = v;\n    };\n\n    /**\n     * Get a unique ID.\n     *\n     * @return {String}\n     */\n    Maker.prototype.uuid = function() {\n        return (Math.random().toString(36).substring(2, 7)) + (((new Date()).getTime()).toString(36));\n    };\n\n    /**\n     * Wrap some script in a function waiting for the document to be ready.\n     *\n     * @param {String} code The script.\n     * @return {String} The new script.\n     */\n    Maker.prototype._wrapForOnReady = function(code) {\n        return 'document.addEventListener(\"DOMContentLoaded\", function(e) {' + code + '});';\n    };\n\n    return /** @alias module:block_stash/drop-snippet-maker */ Maker;\n\n});\n"],"file":"drop-snippet-maker.min.js"}