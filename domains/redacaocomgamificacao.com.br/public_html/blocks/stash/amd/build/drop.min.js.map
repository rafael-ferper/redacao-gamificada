{"version":3,"sources":["../src/drop.js"],"names":["define","$","Ajax","Log","Base","Counselor","Item","UserItem","Drop","dropdata","item","prototype","constructor","apply","_item","Object","create","EVENT_PICKEDUP","getItem","isVisible","call","methodname","args","dropid","get","hashcode","then","visible","Deferred","reject","pickup","fail","debug","data","userItem","useritem","trigger","id","bind"],"mappings":"AAuBAA,OAAM,oBAAC,CACH,QADG,CAEH,WAFG,CAGH,UAHG,CAIH,kBAJG,CAKH,uBALG,CAMH,kBANG,CAOH,uBAPG,CAAD,CAQH,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAuBC,CAAvB,CAA6BC,CAA7B,CAAwCC,CAAxC,CAA8CC,CAA9C,CAAwD,CAQvD,QAASC,CAAAA,CAAT,CAAcC,CAAd,CAAwBC,CAAxB,CAA8B,CAC1BN,CAAI,CAACO,SAAL,CAAeC,WAAf,CAA2BC,KAA3B,CAAiC,IAAjC,CAAuC,CAACJ,CAAD,CAAvC,EACA,KAAKK,KAAL,CAAaJ,CAChB,CACDF,CAAI,CAACG,SAAL,CAAiBI,MAAM,CAACC,MAAP,CAAcZ,CAAI,CAACO,SAAnB,CAAjB,CAEAH,CAAI,CAACG,SAAL,CAAeM,cAAf,CAAgC,eAAhC,CAOAT,CAAI,CAACG,SAAL,CAAeO,OAAf,CAAyB,UAAW,CAChC,MAAO,MAAKJ,KACf,CAFD,CASAN,CAAI,CAACG,SAAL,CAAeQ,SAAf,CAA2B,UAAW,CAClC,MAAOjB,CAAAA,CAAI,CAACkB,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,6BADE,CAEdC,IAAI,CAAE,CACFC,MAAM,CAAE,KAAKC,GAAL,CAAS,IAAT,CADN,CAEFC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFR,CAFQ,CAAD,CAAV,EAMH,CANG,EAMAE,IANA,CAMK,SAASC,CAAT,CAAkB,CAC1B,GAAI,CAACA,CAAL,CAAc,CACV,MAAO1B,CAAAA,CAAC,CAAC2B,QAAF,GAAaC,MAAb,EACV,CACD,QACH,CAXM,CAYV,CAbD,CAoBArB,CAAI,CAACG,SAAL,CAAemB,MAAf,CAAwB,UAAW,CAC/B,MAAO5B,CAAAA,CAAI,CAACkB,IAAL,CAAU,CAAC,CACdC,UAAU,CAAE,yBADE,CAEdC,IAAI,CAAE,CACFC,MAAM,CAAE,KAAKC,GAAL,CAAS,IAAT,CADN,CAEFC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFR,CAFQ,CAAD,CAAV,EAMH,CANG,EAMAO,IANA,CAMK,UAAW,CACnB5B,CAAG,CAAC6B,KAAJ,CAAU,kCAAV,CAEH,CATM,EASJN,IATI,CASC,SAASO,CAAT,CAAe,CAEnB,GAAIC,CAAAA,CAAQ,CAAG,GAAI3B,CAAAA,CAAJ,CAAa0B,CAAI,CAACE,QAAlB,CAA4B,GAAI7B,CAAAA,CAAJ,CAAS2B,CAAI,CAACvB,IAAd,CAA5B,CAAf,CACAL,CAAS,CAAC+B,OAAV,CAAkB,KAAKnB,cAAvB,CAAuC,CACnCoB,EAAE,CAAE,KAAKb,GAAL,CAAS,IAAT,CAD+B,CAEnCC,QAAQ,CAAE,KAAKD,GAAL,CAAS,UAAT,CAFyB,CAGnCW,QAAQ,CAAED,CAHyB,CAAvC,CAKH,CARO,CAQNI,IARM,CAQD,IARC,CATD,CAkBV,CAnBD,CAqBA,MAA6C9B,CAAAA,CAEhD,CAjFK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Drop module.\n *\n * @package    block_stash\n * @copyright  2016 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/log',\n    'block_stash/base',\n    'block_stash/counselor',\n    'block_stash/item',\n    'block_stash/user-item',\n], function($, Ajax, Log, Base, Counselor, Item, UserItem) {\n\n    /**\n     * Drop class.\n     *\n     * @param {Object} dropdata The data of this drop.\n     * @param {Item} item The item related to this drop.\n     */\n    function Drop(dropdata, item) {\n        Base.prototype.constructor.apply(this, [dropdata]);\n        this._item = item;\n    }\n    Drop.prototype = Object.create(Base.prototype);\n\n    Drop.prototype.EVENT_PICKEDUP = 'drop:pickedup';\n\n    /**\n     * Return the item of this drop.\n     *\n     * @return {Item}\n     */\n    Drop.prototype.getItem = function() {\n        return this._item;\n    };\n\n    /**\n     * Is the drop visible to the current user?\n     *\n     * @return {Promise} Rejected when not visible.\n     */\n    Drop.prototype.isVisible = function() {\n        return Ajax.call([{\n            methodname: 'block_stash_is_drop_visible',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].then(function(visible) {\n            if (!visible) {\n                return $.Deferred().reject();\n            }\n            return true;\n        });\n    };\n\n    /**\n     * Report the drop has having been picked up.\n     *\n     * @return {Promise} Resolved when picked up without errors.\n     */\n    Drop.prototype.pickup = function() {\n        return Ajax.call([{\n            methodname: 'block_stash_pickup_drop',\n            args: {\n                dropid: this.get('id'),\n                hashcode: this.get('hashcode')\n            }\n        }])[0].fail(function() {\n            Log.debug('The item could not be picked up.');\n\n        }).then(function(data) {\n            // Do not change this._item as it's not a predictable behaviour.\n            var userItem = new UserItem(data.useritem, new Item(data.item));\n            Counselor.trigger(this.EVENT_PICKEDUP, {\n                id: this.get('id'),\n                hashcode: this.get('hashcode'),\n                useritem: userItem\n            });\n        }.bind(this));\n    };\n\n    return /** @alias module:block_stash/drop */ Drop;\n\n});\n"],"file":"drop.min.js"}