{"version":3,"sources":["../src/dialogue-base.js"],"names":["define","$","Y","Str","DialogueBase","deferred","Deferred","_ready","promise","use","_init","then","resolve","bind","prototype","_dialogue","_title","center","centerDialogue","loading","Node","create","M","util","image_url","d","core","dialogue","draggable","modal","width","origHide","hide","apply","arguments","destroy","getStdModNode","WidgetStdMod","HEADER","prepend","_updateDialogueTitle","_setDialogueContent","_render","fail","get_string","a","always","txt","close","find","selector","_container","show","e","content","setStdModContent","BODY","REPLACE","setTitle","title","one","setHTML"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Show item detail.\n *\n * @package    block_stash\n * @copyright  2016 Adrian Greeve <adriangreeve.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n    'jquery',\n    'core/yui',\n    'core/str',\n], function($, Y, Str) {\n\n    /**\n     * Constructor.\n     *\n     * Override it to inject your arguments.\n     */\n    function DialogueBase() {\n        var deferred = $.Deferred();\n        this._ready = deferred.promise();\n        Y.use('moodle-core-notification', function() {\n            this._init().then(function() {\n                deferred.resolve();\n            });\n        }.bind(this));\n    }\n\n    DialogueBase.prototype._dialogue = null;\n    DialogueBase.prototype._ready = null;\n    DialogueBase.prototype._title = '&hellip;';\n\n    /**\n     * Center the dialogue on screen.\n     */\n    DialogueBase.prototype.center = function() {\n        this._dialogue.centerDialogue();\n    };\n\n    /**\n     * Initialise the things.\n     *\n     * @return {Void}\n     */\n    DialogueBase.prototype._init = function() {\n        var deferred = $.Deferred(),\n            loading = Y.Node.create('<p style=\"text-align: center;\"><img src=\"' + M.util.image_url('y/loading') + '\" alt=\"\"></p>'),\n            d;\n\n        // New dialogue.\n        d = new M.core.dialogue({\n            draggable: true,\n            modal: true,\n            width: '600px',\n        });\n        this._dialogue = d;\n\n        // Destroy on hide.\n        var origHide = d.hide;\n        d.hide = function() {\n            origHide.apply(d, arguments);\n            this.destroy();\n        }.bind(d);\n\n        // Set content.\n        d.getStdModNode(Y.WidgetStdMod.HEADER).prepend(Y.Node.create('<h1>'));\n        this._updateDialogueTitle();\n        this._setDialogueContent(loading);\n        deferred.resolve();\n\n        // Render the things.\n        this._render().fail(function() {\n            Str.get_string('error', 'core')\n            .then(function(a) {\n                return a;\n            })\n            .fail(function() {\n                return '';\n            })\n            .always(function(txt) {\n                this._setDialogueContent(txt);\n            }.bind(this));\n        }.bind(this));\n\n        // Return the promise.\n        return deferred.promise();\n    };\n\n    DialogueBase.prototype.close = function() {\n        this._dialogue.destroy();\n    };\n\n    /**\n     * Find a node in this Dialog.\n     *\n     * @param {String} selector The selector.\n     * @return {Node}\n     */\n    DialogueBase.prototype.find = function(selector) {\n        return this._container.find(selector);\n    };\n\n    /**\n     * Render mechanics.\n     *\n     * This is the method to override to set the content of the dialogue.\n     * It must be non-blocking. Also do not forget to center the dialogue.\n     */\n    DialogueBase.prototype._render = function() {\n        // Nothing here.\n    };\n\n    /**\n     * Initialise the things.\n     *\n     * @param {Event} e The event.\n     */\n    DialogueBase.prototype.show = function(e) {\n        this._ready.then(function() {\n            this._dialogue.show(e);\n        }.bind(this));\n    };\n\n    /**\n     * Set the dialogue content.\n     *\n     * @param {String} content The HTML content.\n     */\n    DialogueBase.prototype._setDialogueContent = function(content) {\n        this._dialogue.setStdModContent(Y.WidgetStdMod.BODY, content, Y.WidgetStdMod.REPLACE);\n    };\n\n    /**\n     * Set the dialogue title.\n     *\n     * @param {String} title The title.\n     */\n    DialogueBase.prototype.setTitle = function(title) {\n        this._title = title;\n        this._updateDialogueTitle();\n    };\n\n    /**\n     * Update the dialogue title.\n     */\n    DialogueBase.prototype._updateDialogueTitle = function() {\n        if (!this._dialogue) {\n            return;\n        }\n\n        this._dialogue.getStdModNode(Y.WidgetStdMod.HEADER).one('h1').setHTML(this._title);\n    };\n\n    return DialogueBase;\n\n});\n"],"file":"dialogue-base.min.js"}